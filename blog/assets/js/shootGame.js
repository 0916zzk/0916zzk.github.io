(()=>{"use strict";function t(t,e){for(var n in e)t.style[n]=e[n]}function e(t){return document.querySelector(t)}const n=e(".ball_area"),o=e(".battery"),r=e(".bullet"),c=e(".game_area"),l=e(".start"),i=e(".score");let f=[];const a={},s=n.offsetWidth,u=n.offsetHeight;let d,p,h=!1;T(),g(),l.addEventListener("click",(function(t){h=!0,clearInterval(d),d=setInterval(x(),1e4)})),c.addEventListener("mousemove",(function(t){let e=t.clientX,n=t.clientY,{x:r,y:c}=function(t){for(var e={x:0,y:0};t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop,t=t.offsetParent,e.x+=t.clientLeft,e.y+=t.clientTop;return e}(o);r+=30,c+=56;let l=180*Math.atan2(e-r,c-n)/Math.PI;l=Math.min(80,Math.max(-80,l)),o.style.transform=`rotate(${l}deg)`}));const m=n.offsetWidth-r.offsetWidth;function x(e=10){return f.filter((({connect:t})=>!t)).slice(0,e).forEach((e=>function(e){let n=k();e.connect=!0,e.color=n,t(e.ele,{display:"block",backgroundColor:n,left:e.left+"px",top:e.top+"px"})}(e))),x}function y(e){!function(e,n=""){e.connect=!0,e.color=n,t(e.ele,{display:"block",top:e.top+"px",left:e.left+"px",backgroundColor:n})}(f[e],a.color);let n=M([e],!0),o=Number(i.innerText);n.length>=3&&(o+=n.length,n.forEach((t=>{f[t].connect=!1}))),f.forEach((t=>{if(!t.connect)return!1;M([t.index],!1).some((t=>t<10))||(t.connect=!1,o++)})),i.innerText=o,g()}function b(t=[]){return t.reduce(((t,e)=>e.distance<t.distance?e:t),{distance:1/0})}function v(t,e,n){let o=t.left-e,r=t.top-n,c=Math.sqrt(o*o+r*r);return{idx:t.index,distance:c}}function g(){let e=n.offsetWidth/2-o.offsetWidth/2+"px",c=n.offsetWidth/2-r.offsetWidth/2+"px",l=n.offsetHeight-30+"px",i=n.offsetHeight+5+"px",f=k();a.color=f,t(o,{left:e,top:l}),t(r,{left:c,top:i,backgroundColor:f})}function T(){n.innerHTML="",f=[];let t=0,e=~~(u/44),o=~~(s/44),r=document.createDocumentFragment();for(let n=0;n<e;n++){let e=!!(n%2);for(let c=0;c<o-Number(e);c++){let e=38*n,o=44*(c+n%2/2),l=document.createElement("div"),i=new Proxy({top:e,left:o,ele:l,index:t,row:n,connect:!1},{set:(t,e,n)=>("connect"===e&&!1===n&&L(t.ele),t[e]=n,!0)});l.classList.add("ball"),l.innerText=t++,l.style.display="none",r.appendChild(l),f.push(i)}}n.appendChild(r)}function L(e){!function(e,n,o,r,c){o=o||500,r=r||"linear",e.style.transition=`${o}ms ${r}`,t(e,n),e.addEventListener("transitionend",(function t(){e.removeEventListener("transitionend",t),e.style.transition="0ms",setTimeout((function(){c&&c()}),0)}))}(e,{opacity:0,transform:"scale(.5)",top:e.offsetTop+40+"px"},500,"linear",(function(){e.style.cssText="",t(e,{display:"none"})}))}function M(t=[],e=!0){let n=t.slice();return function t(o){for(let r=0,c=o.length;r<c;r++){let c=E(o[r],e).filter((t=>-1===n.indexOf(t)));n.push.apply(n,c),t(c)}}(n),n}function E(t=0,e=!0){return Object.entries(I(t)).map((([t,e])=>e)).filter((n=>!(null===n||!f[n].connect||e&&f[t]?.color!==f[n]?.color)))}function I(t=0){return function(t,e){const n={t:-1,m:0,b:1};let o=f[t].row;return Object.entries(e).reduce((function(t,[e,r]){var c;return t[e]=f[r]&&(c=f[r].row,o+n[e[0]]===c)?r:null,t}),{})}(t,{tl:t-10,tr:t-9,ml:t-1,mr:t+1,bl:t+9,br:t+10})}function k(){const t=["#fa5a5a","#f0d264","#82c8a0","#7fccde","#6698cb","#cb99c5"];return t[~~(Math.random()*t.length)]}c.addEventListener("click",(function(t){if(!h)return!1;let e=(o.style.transform.match(/.*\((.+)deg\)/)?.[1]||0)/180*Math.PI,n=18*Math.sin(e),c=18*Math.cos(e);clearInterval(p),p=setInterval((()=>{let t=r.offsetTop,e=r.offsetLeft;(e<0||e>=m)&&(n*=-1);let o=function({left:t,top:e}){let n=f.filter((({connect:t})=>t)).map((n=>v(n,t,e))).filter((({distance:t})=>t<=44));return 0===n.length?null:n.reduce(((t,e)=>e.distance<t.distance?e:t),{distance:1/0})}({left:e,top:t});if(o){clearInterval(p);let n=Object.entries(I(o.idx)).map((([t,e])=>e)).filter((t=>t&&!f[t].connect)).map((n=>v(f[n],e,t)));if(t>f[f.length-1].top)return clearInterval(d),h=!1,T(),g(),i.innerText=0,!1;let{idx:r}=b(n);return y(r),!0}if(t<0){clearInterval(p);let n=f.slice(0,10).filter((({connect:t})=>!t)).map((({index:t})=>t)).map((n=>v(f[n],e,t))),{idx:o}=b(n);return y(o),!1}r.style.top=t-c+"px",r.style.left=e+n+"px"}),1e3/60)}))})();